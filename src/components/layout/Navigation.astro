---
const navLinks = [
    { href: "/noticias/", text: "notícias" },
    { href: "/receitas/", text: "receitas" },
    { href: "/midias/", text: "mídias" },
    { href: "/fatos-aleatorios/", text: "fatos aleatórios" },
];
const currentPath = Astro.url.pathname;
---

<nav class="main-nav">
    <button
        class="menu-toggle"
        aria-controls="nav-menu"
        aria-expanded="false"
        aria-label="Abrir menu"
    >
        <div class="hamburger-box">
            <span class="line"></span>
            <span class="line"></span>
            <span class="line"></span>
        </div>
    </button>

    <ul class="nav-list" id="nav-menu">
        {
            navLinks.map((link, index) => (
                <li
                    class:list={[
                        "nav-item",
                        { active: currentPath.startsWith(link.href) },
                    ]}
                    style={`--delay: ${index * 100}ms`}
                >
                    <a
                        href={link.href}
                        aria-current={
                            currentPath.startsWith(link.href) ? "page" : false
                        }
                    >
                        {link.text}
                    </a>
                </li>
            ))
        }
    </ul>
</nav>

<script>
    const nav = document.querySelector(".main-nav")!;
    const toggleButton = nav.querySelector(".menu-toggle")!;
    const navList = nav.querySelector(".nav-list")!;

    toggleButton.addEventListener("click", () => {
        const isExpanded = nav.classList.toggle("is-open");
        toggleButton.setAttribute("aria-expanded", String(isExpanded));
    });

    navList.addEventListener("click", (e) => {
        if (e.target && (e.target as HTMLElement).tagName === "A") {
            nav.classList.remove("is-open");
            toggleButton.setAttribute("aria-expanded", "false");
        }
    });
</script>

<style>
    .main-nav {
        position: relative;
        z-index: 1000;
    }

    .menu-toggle {
        display: block;
        position: fixed;
        top: 1rem;
        right: 1rem;
        width: 40px;
        height: 40px;
        background: #fff;
        border: 2px solid #3d3522;
        border-radius: 50%;
        box-shadow: 4px 4px 0px #3d3522;
        cursor: pointer;
        z-index: 1001;
    }
    .hamburger-box {
        position: relative;
        width: 24px;
        height: 18px;
        margin: auto;
    }
    .line {
        position: absolute;
        left: 0;
        width: 100%;
        height: 3px;
        background-color: #3d3522;
        border-radius: 3px;
        transition:
            transform 0.3s ease-in-out,
            opacity 0.3s ease-in-out;
    }
    .line:nth-child(1) {
        top: 0;
    }
    .line:nth-child(2) {
        top: 50%;
        transform: translateY(-50%);
    }
    .line:nth-child(3) {
        bottom: 0;
    }

    .main-nav.is-open .line:nth-child(1) {
        transform: translateY(7.5px) rotate(45deg);
    }
    .main-nav.is-open .line:nth-child(2) {
        opacity: 0;
    }
    .main-nav.is-open .line:nth-child(3) {
        transform: translateY(-7.5px) rotate(-45deg);
    }

    .nav-list {
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        gap: 2rem;
        list-style: none;
        margin: 0;
        padding: 0;

        position: fixed;
        top: 0;
        right: 0;
        width: 100vw;
        height: 100vh;
        background: #ffd700;

        transform: translateX(100%);
        transition: transform 0.4s cubic-bezier(0.86, 0, 0.07, 1);
    }
    .main-nav.is-open .nav-list {
        transform: translateX(0);
    }
    .nav-item {
        opacity: 0;
        transform: translateY(20px);
        animation: slideInUp 0.5s ease-out forwards;
        animation-delay: var(--delay); /* Animação escalonada */
    }
    .nav-list a {
        font-family: "Fredoka One", cursive;
        font-size: 2rem;
        color: #3d3522;
        text-decoration: none;
    }

    @keyframes slideInUp {
        to {
            opacity: 1;
            transform: translateY(0);
        }
    }

    @media (min-width: 900px) {
        .menu-toggle {
            display: none;
        }
        .main-nav {
            display: flex;
            justify-content: center;
            padding: 1rem;
        }
        .nav-list {
            all: unset; /* Reseta todos os estilos do mobile */
            display: flex;
            list-style: none;
            gap: 1.5rem;
        }
        .nav-item {
            all: unset;
            cursor: pointer;
        }
        .nav-list a {
            all: unset; /* Reseta o estilo dos links do mobile */
            font-family: "Poppins", sans-serif;
            font-weight: 700;
            color: #3d3522;
            text-decoration: none;
            display: block;
            padding: 0.8rem 1.5rem;
            border: 2px solid #3d3522;
            transition:
                border-radius 0.3s ease,
                transform 0.2s ease,
                background-color 0.2s ease;
        }

        /* 3. A mágica das formas orgânicas! */
        .nav-item a {
            border-radius: 47% 53% 70% 30% / 30% 45% 55% 70%;
        }
        .nav-item:nth-child(2) a {
            border-radius: 70% 30% / 47% 53% 30% 70%;
        }
        .nav-item:nth-child(3) a {
            border-radius: 30% 70% 30% 70% / 53% 30% 70% 47%;
        }
        .nav-item:nth-child(4) a {
            border-radius: 30% 70% 55% 45% / 70% 47% 53% 30%;
        }

        /* Hover: A forma se transforma e levanta */
        .nav-item:hover a {
            transform: translateY(-5px);
            border-radius: 30% 70% 55% 45% / 70% 47% 53% 30%;
        }

        .nav-item.active a {
            background-color: #3d3522;
            color: #ffd700;
            border-radius: 50%; /* O item ativo tem uma forma mais estável, quase um círculo */
        }
    }
</style>
